"use client"
import {FC, useEffect, useState} from "react";
import Link from "next/link";
import {useWishlist} from "@/hooks/WishlistHook";
import {useModals} from "@/hooks/ModalsHook";
import {useUser} from "@/hooks/UserHook";

const AddToWishlist:FC<{className? : string ,id : number}> = ({className,id}) => {
    const {checkIsInWishlist,addToWishlist,removeFromWishlist} = useWishlist()
    const { modalsHandlers : {authHandler} } = useModals()
    const {isLogged} = useUser()
    const isInWishlist = checkIsInWishlist(id)
    const [isDisabled,setIsDisabled] = useState(false)

    useEffect(() => {
        setIsDisabled(false)
    }, [isInWishlist,id]);
    return(
        <>
            {isInWishlist ?
                <Link
                    onClick={(e) => {
                        e.preventDefault()
                        setIsDisabled(true)
                        removeFromWishlist(id)
                    }}
                    className={`${className ?? 'absolute right-2 xl:bottom-[60px]'} ${isDisabled ? ' flip-anim' : ''}`}
                    href={"#"}>
                    <svg className="group-wishicon duration-200" width="36" height="36" viewBox="0 0 36 36"
                         fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect className="fill-[#46B1F0] duration-200" width="36" height="36"
                              rx="18" fill="#F7F7F7" />
                        <path
                            className="stroke-[#F6F6F6] fill-[#F6F6F6] duration-200"
                            d="M17.9192 11.7307C18.3489 11.2437 18.8752 10.7675 19.4983 10.302C20.1213 9.83651 20.8411 9.53931 21.6575 9.4104C22.4023 9.31014 23.0898 9.33879 23.72 9.49634C24.3359 9.65389 24.8909 9.90454 25.385 10.2483C25.8792 10.592 26.2909 11.0146 26.6204 11.5159C26.9641 12.0028 27.2148 12.5185 27.3723 13.0627C27.5442 13.6643 27.6265 14.3375 27.6194 15.0823C27.6122 15.8271 27.5012 16.5146 27.2864 17.1448C26.9713 17.9612 26.5631 18.6988 26.0618 19.3577C25.5461 20.0165 24.9804 20.636 24.3645 21.2161C23.7486 21.7961 23.1112 22.3512 22.4524 22.8811C21.7935 23.4111 21.1562 23.9482 20.5403 24.4924C20.3971 24.6643 20.2216 24.8505 20.0139 25.051C19.8062 25.2515 19.5806 25.4377 19.3372 25.6096C19.1939 25.7528 19.0077 25.9677 18.7786 26.2542C18.5494 26.5406 18.3059 26.6838 18.0481 26.6838C17.8189 26.6838 17.6184 26.5943 17.4465 26.4153C17.2747 26.2362 17.1028 26.0393 16.9309 25.8245C16.3866 25.2229 15.7922 24.6571 15.1477 24.1272C14.5175 23.5972 13.8801 23.0673 13.2356 22.5374C12.5911 22.0074 11.9752 21.456 11.3879 20.8831C10.7864 20.3101 10.2564 19.6799 9.7981 18.9924C9.55461 18.6344 9.31828 18.219 9.08911 17.7463C8.87427 17.2594 8.70239 16.7402 8.57349 16.1887C8.44458 15.6373 8.38013 15.068 8.38013 14.4807C8.38013 13.8935 8.48039 13.3062 8.68091 12.719C8.99601 11.8023 9.54028 11.0181 10.3137 10.3665C11.0872 9.71476 12.0754 9.36743 13.2786 9.32446C14.4387 9.26717 15.3625 9.5035 16.05 10.0334C16.7375 10.5634 17.3606 11.1292 17.9192 11.7307ZM23.8489 19.1213C24.2929 18.6773 24.7262 18.151 25.1487 17.5422C25.5712 16.9335 25.8398 16.2424 25.9543 15.469C26.0546 14.5523 25.9364 13.7467 25.5999 13.052C25.2633 12.3573 24.7942 11.8453 24.1926 11.5159C23.9778 11.4156 23.6913 11.3189 23.3333 11.2258C22.9752 11.1327 22.6028 11.0862 22.2161 11.0862C21.7291 11.1292 21.2708 11.2867 20.8411 11.5588C20.4114 11.831 20.0676 12.0745 19.8098 12.2893C19.6809 12.3896 19.5413 12.5185 19.3909 12.676C19.2405 12.8336 19.0793 12.9911 18.9075 13.1487C18.7356 13.3206 18.5995 13.4924 18.4993 13.6643C18.399 13.8362 18.2056 13.9221 17.9192 13.9221C17.7043 13.9221 17.5146 13.8362 17.3499 13.6643C17.1851 13.4924 17.0455 13.3206 16.9309 13.1487C16.759 13.0055 16.5979 12.8551 16.4475 12.6975C16.2971 12.54 16.1575 12.4039 16.0286 12.2893C15.7135 12.0172 15.3554 11.7486 14.9543 11.4836C14.5533 11.2187 14.0806 11.0862 13.5364 11.0862C12.4908 11.1292 11.6529 11.4801 11.0227 12.1389C10.3925 12.7978 10.0559 13.6213 10.0129 14.6096C9.95565 15.3114 10.038 15.9452 10.26 16.511C10.482 17.0767 10.7577 17.5745 11.0872 18.0042C11.5312 18.6344 12.0468 19.2288 12.634 19.7874C13.2213 20.3316 13.8264 20.8652 14.4495 21.3879C15.0725 21.9107 15.692 22.4371 16.3079 22.967C16.9094 23.4827 17.4465 24.0341 17.9192 24.6213C18.3632 24.1344 18.8287 23.6617 19.3157 23.2034C19.8027 22.7594 20.3004 22.3153 20.8088 21.8713C21.3173 21.4273 21.8293 20.9833 22.345 20.5393C22.8463 20.0953 23.3476 19.6226 23.8489 19.1213Z"
                            fill="#46B1F0" />
                    </svg>
                </Link>
                :
                <Link
                    onClick={(e) => {
                        e.preventDefault()
                        if(isLogged) {
                            setIsDisabled(true)
                            addToWishlist(id)
                        } else  {
                            authHandler()
                        }
                    }}
                    className={`${className ?? 'absolute right-2 xl:bottom-[60px]'} ${isDisabled ? ' flip-anim' : ''}`}
                    href={"#"}>
                    <svg className="group-wishicon duration-200" width="36" height="36" viewBox="0 0 36 36"
                         fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect className="duration-200" width="36" height="36"
                              rx="18" fill="#F7F7F7" />
                        <path
                            className=" duration-200"
                            d="M17.9192 11.7307C18.3489 11.2437 18.8752 10.7675 19.4983 10.302C20.1213 9.83651 20.8411 9.53931 21.6575 9.4104C22.4023 9.31014 23.0898 9.33879 23.72 9.49634C24.3359 9.65389 24.8909 9.90454 25.385 10.2483C25.8792 10.592 26.2909 11.0146 26.6204 11.5159C26.9641 12.0028 27.2148 12.5185 27.3723 13.0627C27.5442 13.6643 27.6265 14.3375 27.6194 15.0823C27.6122 15.8271 27.5012 16.5146 27.2864 17.1448C26.9713 17.9612 26.5631 18.6988 26.0618 19.3577C25.5461 20.0165 24.9804 20.636 24.3645 21.2161C23.7486 21.7961 23.1112 22.3512 22.4524 22.8811C21.7935 23.4111 21.1562 23.9482 20.5403 24.4924C20.3971 24.6643 20.2216 24.8505 20.0139 25.051C19.8062 25.2515 19.5806 25.4377 19.3372 25.6096C19.1939 25.7528 19.0077 25.9677 18.7786 26.2542C18.5494 26.5406 18.3059 26.6838 18.0481 26.6838C17.8189 26.6838 17.6184 26.5943 17.4465 26.4153C17.2747 26.2362 17.1028 26.0393 16.9309 25.8245C16.3866 25.2229 15.7922 24.6571 15.1477 24.1272C14.5175 23.5972 13.8801 23.0673 13.2356 22.5374C12.5911 22.0074 11.9752 21.456 11.3879 20.8831C10.7864 20.3101 10.2564 19.6799 9.7981 18.9924C9.55461 18.6344 9.31828 18.219 9.08911 17.7463C8.87427 17.2594 8.70239 16.7402 8.57349 16.1887C8.44458 15.6373 8.38013 15.068 8.38013 14.4807C8.38013 13.8935 8.48039 13.3062 8.68091 12.719C8.99601 11.8023 9.54028 11.0181 10.3137 10.3665C11.0872 9.71476 12.0754 9.36743 13.2786 9.32446C14.4387 9.26717 15.3625 9.5035 16.05 10.0334C16.7375 10.5634 17.3606 11.1292 17.9192 11.7307ZM23.8489 19.1213C24.2929 18.6773 24.7262 18.151 25.1487 17.5422C25.5712 16.9335 25.8398 16.2424 25.9543 15.469C26.0546 14.5523 25.9364 13.7467 25.5999 13.052C25.2633 12.3573 24.7942 11.8453 24.1926 11.5159C23.9778 11.4156 23.6913 11.3189 23.3333 11.2258C22.9752 11.1327 22.6028 11.0862 22.2161 11.0862C21.7291 11.1292 21.2708 11.2867 20.8411 11.5588C20.4114 11.831 20.0676 12.0745 19.8098 12.2893C19.6809 12.3896 19.5413 12.5185 19.3909 12.676C19.2405 12.8336 19.0793 12.9911 18.9075 13.1487C18.7356 13.3206 18.5995 13.4924 18.4993 13.6643C18.399 13.8362 18.2056 13.9221 17.9192 13.9221C17.7043 13.9221 17.5146 13.8362 17.3499 13.6643C17.1851 13.4924 17.0455 13.3206 16.9309 13.1487C16.759 13.0055 16.5979 12.8551 16.4475 12.6975C16.2971 12.54 16.1575 12.4039 16.0286 12.2893C15.7135 12.0172 15.3554 11.7486 14.9543 11.4836C14.5533 11.2187 14.0806 11.0862 13.5364 11.0862C12.4908 11.1292 11.6529 11.4801 11.0227 12.1389C10.3925 12.7978 10.0559 13.6213 10.0129 14.6096C9.95565 15.3114 10.038 15.9452 10.26 16.511C10.482 17.0767 10.7577 17.5745 11.0872 18.0042C11.5312 18.6344 12.0468 19.2288 12.634 19.7874C13.2213 20.3316 13.8264 20.8652 14.4495 21.3879C15.0725 21.9107 15.692 22.4371 16.3079 22.967C16.9094 23.4827 17.4465 24.0341 17.9192 24.6213C18.3632 24.1344 18.8287 23.6617 19.3157 23.2034C19.8027 22.7594 20.3004 22.3153 20.8088 21.8713C21.3173 21.4273 21.8293 20.9833 22.345 20.5393C22.8463 20.0953 23.3476 19.6226 23.8489 19.1213Z"
                            fill="#46B1F0" />
                    </svg>
                </Link>

            }
        </>
    )
}
export default AddToWishlist